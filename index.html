<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub 内容代理 (纯 HTML/JS)</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .error { color: red; }
           pre { background-color:#f0f0f0; padding: 10px; overflow-x: auto; }
           img { max-width: 100%; height: auto; }
    </style>
</head>
<body>
    <h1>GitHub 内容代理 (纯 HTML + JS)</h1>
    <div id="content-area"></div>

    <script>
        async function fetchGitHubContent() {
             const urlParams = new URLSearchParams(window.location.search);
            const path = urlParams.get('path');


            if (!path){
                    document.getElementById('content-area').innerHTML = "<p class='error'>Error: Path parameter 'path' is missing from the URL.  e.g /index.html?path=/myuser/myrepo/master/myfile.txt</p>";
                return;
            }
             const rawBaseUrl = "https://raw.githubusercontent.com"; //GitHub Raw URL
             let cleanPath = path.replace('/refs/heads/', '/');
             const targetUrl =  rawBaseUrl + cleanPath;
               const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(targetUrl)}`;


             try {
                const response = await fetch(proxyUrl);
               if(!response.ok)
                   {
                         document.getElementById('content-area').innerHTML = `<p class='error'>Error: Could not fetch requested content at: ${decodeURIComponent(path)}. Response code: ${response.status}. Please check the URL. </p>`;
                      return;
                   }
                   const contentType = response.headers.get('content-type') || '';

               const content = await response.text();
                let html = `<p><strong>请求路径:</strong> ${path}</p>`;

            html += `<p><strong>清理后的路径:</strong> ${cleanPath}</p>`;
           html += `<p><strong>目标 URL:</strong> <a href="${targetUrl}" target="_blank">${targetUrl}</a> </p>`;
         html += "<p><strong>以下是从 GitHub 获取的原始内容:</strong></p>";

            if (contentType.startsWith('image/')){

                html += `<img src="data:${contentType};base64,${btoa(content)}" alt="来自 GitHub 的图片"/>`

            }
            else
              {

                  html += `<pre><code>${escapeHtml(content)}</code></pre>`;

              }

              document.getElementById('content-area').innerHTML = html;



            }
            catch (error) {

                 document.getElementById('content-area').innerHTML =  `<p class='error'>An error occurred: ${escapeHtml(error)}</p>`;

            }
        }
             // Function to escape HTML special characters
         function escapeHtml(text) {
            return String(text)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        fetchGitHubContent();
    </script>
</body>
</html>
